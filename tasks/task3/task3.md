## вопрос 1:

Объясните смысл и напишите формулы для следующих метрик производительности процессора IPC, CPI, Performance, Dynamic Power

---

`IPC` - среднее число исполняемых инструкций за такт.

$$ \text{IPC} = \frac{\text{instructions count}}{\text{clock cycles}} $$

`CPI` - среднее количество тактов, затрачиваемое на исполнение одной инструкции

$$ \text{CPI} = \frac{1}{\text{IPC}} $$

`Perfomance` - скорость исполнения последовательности инструкций.

$$ \text{Perfomance} = \frac{1}{\text{Time}} = \frac{1}{\text{N}_{instrs} * CPI * T_{cycle}} =
\frac{1}{\text{N}_{instrs}} * IPC * f $$

Последнее выражение также называется `Golden rule of CS`

`Dynamic Power` - мощность, которая расходуется на перезаряд емкостей транзисторов.

$$ P_{\text{dynamic}} = C_{eff} \times V^2 \times f $$

$f$ - тактовая частота

## вопрос 2:

Что такое суперскалярный (superscalar) процессор?

---

Суперскалярный процессор - это процессор, способный выполнять за такт несколько инструкций. Параллелизм достигается за счет нескольких одинаковых вычислительных устройств, таких как АЛУ, независимо обрабатывающих инструкции одного потока.

## вопрос 3:

Какие типы зависимостей по данным существуют? Приведите примеры аппаратных оптимизаций, которые позволяют сократить связанные задержки или разрешить каждый тип зависимостей.

---

`Read-after-write` - конфликт возникает, когда одна команда пишет в регистр, а следующая читает из него.

```
and %s0 %s1 %s3
add %t0 %s0 %s1
```

Оптимизация - пересылка данных через байпас. Данная оптимизация не всегда может работать. Для `load` команды, например, нужно дополнительно приостановить конвейер.

`Write-After-Read` зависимость:

```
and %s0 %s1 %s3
add %s3 %s1 %s2
```

При параллельном исполнении `%s3` может быть переписан второй инструкцией до чтения.

Оптимизация: динамическое переименование регистров.

`Write-After-Write` - две инструкции параллельно записывают данные в один регистр.

Оптимизация: динамическое переименование регистров.

## вопрос 4:

С какой целью инструкцию Store разделяют на микро-операции STA (Store address calculation) и STD (Store data calculation)?

---

STA - микрооперация, вычисляющая адрес store.
STD - микрооперация, вычисляющая данные store.
Разделение позволяет на более раннем этапе вычислить адрес store и, таким образом, уменьшить число load/store зависимостей.

## вопрос 5:

Объясните назначение и функции следующих аппаратных структур: ROB, Scheduler Queue (Issue Queue, Reservation Station), RAT, PRF, Load Buffer, Store Buffer

---

`Reorder Buffer (ROB)` - хранит последовательный порядок инструкций при ООО исполнении. Инструкция покидает ROB и обновляет архитектурное состояние если она последняя в буфере и была исполнена. Позволяет поддерживать порядок исполнения программы, что является важным при возникновении исключений/прерываний.

`Scheduler Queue` - планирует и отправляет инструкции на исполнение. Проверяет, что операнды готовы перед исполнением.

`RAT(register alias table)` -- таблица соответствия физических и логических регистров используемая при переименовании регистров.

`PRF(Physical Register File)` - хранит значения всех физических регистров

`Load/Store Buffer` - буферы только для load/store инструкций. Все сложные проверки зависимости по данным происходят в этих буферах.

## вопрос 6

Пусть каждая 5ая инструкция в процессоре это Branch. Предсказатель переходов имеет точность 90%. Оцените, ROB какого максимального размера имеет смысл для такого процессора.

---

Хотим уменьшить число промахов, т.к. происходит очистка ROB. Неправильное предсказание происходит раз в

$$  \frac{1}{0.2 * 0.1} = 50 $$

инструкций. Величина ROB должна примерно соответствовать.

## вопрос 7

Что такое Memory Disambiguation?

---

Это методы OOO исполнения для устранения зависимостей по памяти. Они позволяют обнаружить зависимости между операциями с памятью во время выполнения и позволяют процессору восстанавливаться в случае нарушения зависимости. Они обеспечивают больший параллелизм на уровне команд.

## вопрос 8

 В чем заключается проблема со спекулятивным исполнением Store инструкций?

---

Нет способа отменить выполенную store инструкцию.

## вопрос 9

Что такое Store forwarding и Load speculation в OOO процессоре?

---

- Store forwarding - если load и store обращаются к 1 адресу памяти, то load может взять данные непосредственно из предыдущей store инструкции, а не ждать, пока произойдет запись в память.
- Load speculation - спекулятивное разрешение load-store зависимостей. load исполняется, не дожидаясь STA. После STA результат должен быть верифицирован.

## вопрос 10

Что такое Simultaneous Multithreading?

---

Это технология, которая позволяет одному ядру исполнять несколько потоков. Это происходит за счёт разделения одного физического ядра на несколько логических, которые хранят собственное архитектурное состояние.
